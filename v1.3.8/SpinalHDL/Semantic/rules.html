<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rules &mdash; SpinalHDL  documentation</title>
      <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/logo3_32x32.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/2.6.8/skins/default.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/2.6.8/wavedrom.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Sequential logic" href="../Sequential%20logic/index.html" />
    <link rel="prev" title="When/Switch/Mux" href="when_switch.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> SpinalHDL
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../About%20SpinalHDL/index.html">About SpinalHDL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../About%20SpinalHDL/faq.html">FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../About%20SpinalHDL/support.html">Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../About%20SpinalHDL/users.html">Users</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Getting%20Started/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Getting%20Started/getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Getting%20Started/motivation.html">Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Getting%20Started/presentation.html">Presentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Getting%20Started/Scala%20Guide/index.html">Scala Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Getting%20Started/Scala%20Guide/basics.html">Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Getting%20Started/Scala%20Guide/coding_conventions.html">Coding conventions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Getting%20Started/Scala%20Guide/interaction.html">Interaction</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Getting%20Started/Help%20for%20VHDL%20people/index.html">Help for VHDL people</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Getting%20Started/Help%20for%20VHDL%20people/vhdl_comp.html">VHDL comparison</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Getting%20Started/Help%20for%20VHDL%20people/vhdl_perspective.html">VHDL equivalences</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Getting%20Started/Cheatsheets/index.html">Cheatsheets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Getting%20Started/Cheatsheets/core.html">Core</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Getting%20Started/Cheatsheets/lib.html">Lib</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Getting%20Started/Cheatsheets/symbolic.html">Symbolic</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Data%20types/index.html">Data types</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Data%20types/bool.html">Bool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Data%20types/bits.html">Bits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Data%20types/Int.html">UInt/SInt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Data%20types/enum.html">SpinalEnum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Data%20types/bundle.html">Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Data%20types/Vec.html">Vec</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Data%20types/Fix.html">UFix/SFix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Data%20types/Floating.html">Floating</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Structuring/index.html">Structuring</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Structuring/components_hierarchy.html">Component and hierarchy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Structuring/area.html">Area</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Structuring/function.html">Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Structuring/clock_domain.html">Clock domains</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Structuring/blackbox.html">Instantiate VHDL and Verilog IP</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Semantic</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="assignements.html">Assignments</a></li>
<li class="toctree-l2"><a class="reference internal" href="when_switch.html">When/Switch/Mux</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Rules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Sequential%20logic/index.html">Sequential logic</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Sequential%20logic/registers.html">Registers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Sequential%20logic/memory.html">RAM/ROM</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Design%20errors/index.html">Design errors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Design%20errors/assignment_overlap.html">Assignement overlap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Design%20errors/clock_crossing_violation.html">Clock crossing violation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Design%20errors/combinatorial_loop.html">Combinational loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Design%20errors/hierarchy_violation.html">Hierarchy violation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Design%20errors/iobundle.html">Io bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Design%20errors/latch_detected.html">Latch detected</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Design%20errors/no_driver_on.html">No driver on</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Design%20errors/nullpointerexception.html">NullPointerException</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Design%20errors/register_defined_as_component_input.html">Register defined as component input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Design%20errors/scope_violation.html">Scope violation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Design%20errors/spinal_cant_clone.html">Spinal can’t clone class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Design%20errors/unassigned_register.html">Unassigned register</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Design%20errors/unreachable_is_statement.html">Unreachable is statement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Design%20errors/width_mismatch.html">Width mismatch</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Other%20language%20features/index.html">Other language features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Other%20language%20features/utils.html">Utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Other%20language%20features/assertion.html">Assertions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Other%20language%20features/formal.html">Formal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Other%20language%20features/analog_inout.html">Analog and inout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Other%20language%20features/vhdl_generation.html">VHDL and Verilog generation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Libraries/index.html">Libraries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Libraries/utils.html">Utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Libraries/stream.html">Stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Libraries/flow.html">Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Libraries/fragment.html">Fragment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Libraries/fsm.html">State machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Libraries/vexriscv.html">VexRiscv (RV32IM CPU)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Libraries/bus_slave_factory.html">Bus Slave Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Libraries/Bus/index.html">Bus</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Libraries/Bus/amba3/ahblite3.html">AHB-Lite3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Libraries/Bus/amba3/apb3.html">Apb3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Libraries/Bus/amba4/axi4.html">Axi4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Libraries/Bus/avalon/avalonmm.html">AvalonMM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Libraries/Com/index.html">Com</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Libraries/Com/uart.html">UART</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Libraries/IO/index.html">IO</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Libraries/IO/readableOpenDrain.html">ReadableOpenDrain</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Libraries/IO/tristate.html">TriState</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Libraries/Graphics/index.html">Graphics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Libraries/Graphics/colors.html">Colors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Libraries/Graphics/vga.html">VGA</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Libraries/EDA/index.html">EDA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Libraries/EDA/altera/qsysify.html">QSysify</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Simulation/index.html">Simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Simulation/install.html">Setup and installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Simulation/bootstraps.html">Boot a simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Simulation/signal.html">Accessing signals of the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Simulation/clock.html">Clock domains</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Simulation/threadFull.html">Thread-full API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Simulation/threadLess.html">Thread-less API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Simulation/engine.html">Simulation engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Simulation/examples/index.html">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Simulation/examples/asynchronous.html">Asynchronous adder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Simulation/examples/dual_clock_fifo.html">Dual clock fifo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Simulation/examples/single_clock_fifo.html">Single clock fifo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Simulation/examples/synchronous.html">Synchronous adder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Simulation/examples/uart_decoder.html">Uart decoder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Simulation/examples/uart_encoder.html">Uart encoder</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Examples/index.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Examples/Simple%20ones/index.html">Simple ones</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Examples/Simple%20ones/apb3.html">APB3 definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Examples/Simple%20ones/carry_adder.html">Carry adder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Examples/Simple%20ones/color_summing.html">Color summing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Examples/Simple%20ones/counter_with_clear.html">Counter with clear</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Examples/Simple%20ones/introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Examples/Simple%20ones/pll_resetctrl.html">PLL BlackBox and reset controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Examples/Simple%20ones/rgb_to_gray.html">RGB to gray</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Examples/Simple%20ones/sinus_rom.html">Sinus rom</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Examples/Intermediates%20ones/index.html">Intermediates ones</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Examples/Intermediates%20ones/fractal.html">Fractal calculator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Examples/Intermediates%20ones/uart.html">UART</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Examples/Intermediates%20ones/vga.html">VGA</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Examples/Advanced%20ones/index.html">Advanced ones</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Examples/Advanced%20ones/jtag.html">JTAG TAP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Examples/Advanced%20ones/memory_mapped_uart.html">Memory mapped UART</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Examples/Advanced%20ones/pinesec.html">Pinesec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Examples/Advanced%20ones/timer.html">Timer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Legacy/index.html">Legacy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Legacy/riscv.html">RiscV</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Legacy/pinsec/index.html">pinsec</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Legacy/pinsec/hardware.html">Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Legacy/pinsec/hardware_toplevel.html">SoC toplevel (Pinsec)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Legacy/pinsec/introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Legacy/pinsec/software.html">Software</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Developers%20area/index.html">Developers area</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Developers%20area/bus_slave_factory_impl.html">Bus Slave Factory Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Developers%20area/howtodocument.html">How to HACK this documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Developers%20area/types.html">Types</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SpinalHDL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Semantic</a> &raquo;</li>
      <li>Rules</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/SpinalHDL/Semantic/rules.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rules">
<h1>Rules<a class="headerlink" href="#rules" title="Permalink to this headline"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline"></a></h2>
<p>The semantics behind SpinalHDL are important to learn so you understand what is really happening behind the scenes and how to control it.</p>
<p>These semantics are defined by multiple rules:</p>
<ul class="simple">
<li><p>Signals and registers are concurrent to each other (Parallel behavioral, as in VHDL and Verilog)</p></li>
<li><p>An assignement to a combinatorial signal is like expressing a rule which is always true</p></li>
<li><p>An assignement to a register is like expressing a rule which is applied on each cycle of its clock domain</p></li>
<li><p>For each signal, the last valid assignement wins</p></li>
<li><p>Each signal and register can be manipulated as an object during the hardware elaboration in a OOP manner</p></li>
</ul>
</section>
<section id="concurrency">
<h2>Concurrency<a class="headerlink" href="#concurrency" title="Permalink to this headline"></a></h2>
<p>The order in which you assign each combinatorial or register signals as no behavioral impact.</p>
<p>For example, both of the following pieces of code are equivalent:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span> <span class="n">bits</span><span class="p">)</span> <span class="c1">// Define 3 combinatorial signals</span>
<span class="n">c</span> <span class="o">:=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>   <span class="c1">// c will be set to 7</span>
<span class="n">b</span> <span class="o">:=</span> <span class="mi">2</span>       <span class="c1">// b will be set to 2</span>
<span class="n">a</span> <span class="o">:=</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">3</span>   <span class="c1">// a will be set to 5</span>
</pre></div>
</div>
<p>Is equivalent to:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span> <span class="n">bits</span><span class="p">)</span> <span class="c1">// Define 3 combinatorial signals</span>
<span class="n">b</span> <span class="o">:=</span> <span class="mi">2</span>     <span class="c1">// b will be set to 2</span>
<span class="n">a</span> <span class="o">:=</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">3</span> <span class="c1">// a will be set to 5</span>
<span class="n">c</span> <span class="o">:=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="c1">// c will be set to 7</span>
</pre></div>
</div>
<p>More generally, when you use the <code class="docutils literal notranslate"><span class="pre">:=</span></code> assignement operator, it’s like specifying a new rule for the left side signal/register.</p>
</section>
<section id="last-valid-assignement-wins">
<h2>Last valid assignement wins<a class="headerlink" href="#last-valid-assignement-wins" title="Permalink to this headline"></a></h2>
<p>If a combinatorial signal or register is assigned multiple times, the last valid one wins.</p>
<p>As an example:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nc">Bool</span>             <span class="c1">//Define two combinatorial signals</span>
<span class="kd">val</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span> <span class="n">bits</span><span class="p">)</span>   <span class="c1">//Define a combinatorial signal</span>

<span class="n">result</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="n">when</span><span class="p">(</span><span class="n">x</span><span class="p">){</span>
  <span class="n">result</span> <span class="o">:=</span> <span class="mi">2</span>
  <span class="n">when</span><span class="p">(</span><span class="n">y</span><span class="p">){</span>
    <span class="n">result</span> <span class="o">:=</span> <span class="mi">3</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Will produce the following truth table:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>x</p></th>
<th class="head"><p>y</p></th>
<th class="head"><p>=&gt;</p></th>
<th class="head"><p>result</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>False</p></td>
<td><p>False</p></td>
<td></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>False</p></td>
<td><p>True</p></td>
<td></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>True</p></td>
<td><p>False</p></td>
<td></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>True</p></td>
<td><p>True</p></td>
<td></td>
<td><p>3</p></td>
</tr>
</tbody>
</table>
</section>
<section id="signal-and-register-interactions-with-scala-oop-reference-functions">
<h2>Signal and register interactions with Scala (OOP reference + Functions)<a class="headerlink" href="#signal-and-register-interactions-with-scala-oop-reference-functions" title="Permalink to this headline"></a></h2>
<p>In SpinalHDL, each hardware element is modeled by a class instance. This means you can manipulate them by using their referance, such as passing them as an argument to a function.</p>
<p>As an example, the following code implements a register which is incremented when <code class="docutils literal notranslate"><span class="pre">inc</span></code> is True and cleared when <code class="docutils literal notranslate"><span class="pre">clear</span></code> is True (clear has priority over inc) :</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">inc</span><span class="p">,</span> <span class="n">clear</span> <span class="o">=</span> <span class="nc">Bool</span>            <span class="c1">//Define two combinatorial signal/wire</span>
<span class="kd">val</span> <span class="n">counter</span> <span class="o">=</span> <span class="nc">Reg</span><span class="p">(</span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span> <span class="n">bits</span><span class="p">))</span>  <span class="c1">//Define a 8 bits register</span>

<span class="n">when</span><span class="p">(</span><span class="n">inc</span><span class="p">){</span>
  <span class="n">counter</span> <span class="o">:=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
<span class="p">}</span>
<span class="n">when</span><span class="p">(</span><span class="n">clear</span><span class="p">){</span>
  <span class="n">counter</span> <span class="o">:=</span> <span class="mi">0</span>    <span class="c1">//If inc and clear are True, then this  assignement wins (Last valid assignement rule)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can implement exactly the same functionality by mixing the previous example with a function that assignes to counter:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">inc</span><span class="p">,</span> <span class="n">clear</span> <span class="o">=</span> <span class="nc">Bool</span>
<span class="kd">val</span> <span class="n">counter</span> <span class="o">=</span> <span class="nc">Reg</span><span class="p">(</span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span> <span class="n">bits</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">setCounter</span><span class="p">(</span><span class="n">value</span> <span class="p">:</span> <span class="nc">UInt</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">counter</span> <span class="o">:=</span> <span class="n">value</span>
<span class="p">}</span>

<span class="n">when</span><span class="p">(</span><span class="n">inc</span><span class="p">){</span>
  <span class="n">setCounter</span><span class="p">(</span><span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1">// Set counter with counter + 1</span>
<span class="p">}</span>
<span class="n">when</span><span class="p">(</span><span class="n">clear</span><span class="p">){</span>
  <span class="n">counter</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can also integrate the conditional check inside the function:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">inc</span><span class="p">,</span> <span class="n">clear</span> <span class="o">=</span> <span class="nc">Bool</span>
<span class="kd">val</span> <span class="n">counter</span> <span class="o">=</span> <span class="nc">Reg</span><span class="p">(</span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span> <span class="n">bits</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">setCounterWhen</span><span class="p">(</span><span class="n">cond</span> <span class="p">:</span> <span class="nc">Bool</span><span class="p">,</span><span class="n">value</span> <span class="p">:</span> <span class="nc">UInt</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">when</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">counter</span> <span class="o">:=</span> <span class="n">value</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">setCounterWhen</span><span class="p">(</span><span class="n">cond</span> <span class="o">=</span> <span class="n">inc</span><span class="p">,</span>   <span class="n">value</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">setCounterWhen</span><span class="p">(</span><span class="n">cond</span> <span class="o">=</span> <span class="n">clear</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>And also specify what should be assigned to the function:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span> <span class="n">inc</span><span class="p">,</span> <span class="n">clear</span> <span class="o">=</span> <span class="nc">Bool</span>
<span class="kd">val</span> <span class="n">counter</span> <span class="o">=</span> <span class="nc">Reg</span><span class="p">(</span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span> <span class="n">bits</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">setSomethingWhen</span><span class="p">(</span><span class="n">something</span> <span class="p">:</span> <span class="nc">UInt</span><span class="p">,</span><span class="n">cond</span> <span class="p">:</span> <span class="nc">Bool</span><span class="p">,</span><span class="n">value</span> <span class="p">:</span> <span class="nc">UInt</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">when</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">something</span> <span class="o">:=</span> <span class="n">value</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">setSomethingWhen</span><span class="p">(</span><span class="n">something</span> <span class="o">=</span> <span class="n">counter</span><span class="p">,</span> <span class="n">cond</span> <span class="o">=</span> <span class="n">inc</span><span class="p">,</span>   <span class="n">value</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">setSomethingWhen</span><span class="p">(</span><span class="n">something</span> <span class="o">=</span> <span class="n">counter</span><span class="p">,</span> <span class="n">cond</span> <span class="o">=</span> <span class="n">clear</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>All previous examples are strictly equivalent in their generated RTL but also from an SpinalHDL compiler perspective. This is because SpinalHDL only cares about the Scala runtime, it doesn’t care about the Scala syntax itself.</p>
<p>In other words, from a generated RTL generation / SpinalHDL perspective, when you use functions in Scala which generate hardware, it is like the function was inlined. This is also true case for Scala loops, as they will appear like they were unrolled in the generated RTL.</p>
</section>
</section>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="when_switch.html" class="btn btn-neutral float-left" title="When/Switch/Mux" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../Sequential%20logic/index.html" class="btn btn-neutral float-right" title="Sequential logic" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, SpinalHDL.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: v1.3.8
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../../v1.3.1/index.html">v1.3.1</a></dd>
      <dd><a href="rules.html">v1.3.8</a></dd>
      <dd><a href="../../../v1.5.0/SpinalHDL/Semantic/rules.html">v1.5.0</a></dd>
      <dd><a href="../../../v1.6.0/SpinalHDL/Semantic/rules.html">v1.6.0</a></dd>
    </dl>
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../../dev/SpinalHDL/Semantic/rules.html">dev</a></dd>
      <dd><a href="../../../master/SpinalHDL/Semantic/rules.html">master</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>